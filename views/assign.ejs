<h1>Assign a Meal to a Day</h1>

<form method="GET" action="/assign">
  <label for="mealId">Choose a Meal:</label>
  <select name="mealId" onchange="this.form.submit()">
    <option value="">-- Select Meal --</option>
    <% meals.forEach(meal => { %>
      <option value="<%= meal._id %>" <%= selectedMeal && selectedMeal._id.toString() === meal._id.toString() ? 'selected' : '' %>>
        <%= meal.name %>
      </option>
    <% }) %>
  </select>
</form>

<% if (selectedMeal) { %>
  <form method="POST" action="/assign">
    <input type="hidden" name="mealId" value="<%= selectedMeal._id %>">

    <label for="date">Choose Date:</label>
    <input type="date" name="date" required>

    <h2>Choose Products to Add to Shopping List:</h2>

    <% ingredientProducts.forEach(entry => { %>
      <h3><%= entry.ingredient %></h3>
      <div class="product-grid">
        <% entry.products.forEach(p => { %>
          <label class="product-card">
            <input type="checkbox" name="selectedProducts" value="<%= `${entry.ingredient}:::${p.brand} ${p.description}:::${p.price}` %>">
            <% if (p.image) { %>
              <img src="<%= p.image %>" alt="Image" style="height: 80px;"><br>
            <% } %>
            <strong><%= p.brand %></strong><br>
            <%= p.description %><br>
            $<%= p.price.toFixed(2) %>
          </label>
        <% }) %>
      </div>
    <% }) %>

    <button type="submit">Assign Meal</button>
  </form>
<% } %>
