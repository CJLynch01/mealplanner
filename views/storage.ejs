<h1>Food Storage Inventory</h1>
<a href="/">← Back to Weekly Plan</a>

<form method="POST" action="/storage">
  <input name="name" placeholder="Food name" required />
  <input name="quantity" placeholder="How many units?" type="number" required />
  <input name="unit" placeholder="e.g. bag, box" />
  <input name="servingsPerUnit" placeholder="Servings per unit" type="number" required />
  <input name="expires" type="date" />
  <select name="category" required>
    <option value="">-- Select Category --</option>
    <option value="Breakfast">Breakfast</option>
    <option value="Lunch">Lunch</option>
    <option value="Dinner">Dinner</option>
    <option value="Snack">Snack</option>
    <option value="Pantry">Pantry</option>
    <option value="Freezer">Freezer</option>
  </select>
  <button type="submit">Add</button>
</form>

<h2>Current Inventory</h2>

<% if (Object.keys(grouped).length === 0) { %>
  <p>No items in storage yet.</p>
<% } else { %>
  <% for (let category in grouped) { %>
    <h3><%= category %></h3>
    <ul>
      <% grouped[category].forEach(item => { %>
        <li>
          <strong><%= item.name %></strong>:
          <%= item.quantity %> <%= item.unit %>
          (Expires: <%= new Date(item.expires).toDateString() %>)<br>
          <em>Category: <%= item.category %></em><br>

          <% if (item.stats) { %>
            🍽 Total Calories: <%= item.stats.totalCalories.toLocaleString() %> kcal  
            | Protein: <%= item.stats.totalProtein %>g  
            | Covers: <%= item.stats.daysOfSupport %> day(s) for 5 people
          <% } else { %>
            <em>Nutrition data incomplete.</em>
          <% } %>

          <form method="POST" action="/storage/delete/<%= item._id %>" style="display:inline;">
            <button onclick="return confirm('Delete this item?')">🗑️</button>
          </form>
          <a href="/storage/edit/<%= item._id %>">✏️ Edit</a>
        </li>
      <% }) %>
    </ul>
  <% } %>
<% } %>